<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Hello, World! - A-Frame</title>
  <meta name="description" content="Hello, World! - A-Frame">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="./assets/js/aframe.js"></script>
  <script src="./assets/js/aframe-extras.js"></script>
</head>

<body>
  <a-scene device-orientation-permission-ui="">
    <a-assets>
      <img id="texture-floor" src="./assets/images/floor.jpg">
      <img id="texture-wall" src="./assets/images/wall.jpg">
      <a-asset-item id="television" src="./assets/models/television/scene.gltf"></a-asset-item>
      <a-asset-item id="lamp1" src="./assets/models/lamp/scene.gltf"></a-asset-item>
      <a-asset-item id="bed" src="./assets/models/bed/scene.gltf"></a-asset-item>
      <a-asset-item id="nightstand" src="./assets/models/night_stand/scene.gltf"></a-asset-item>
      <a-asset-item id="guitar" src="./assets/models/guitar/scene.gltf"></a-asset-item>
      <a-asset-item id="gym" src="./assets/models/gym/scene.gltf"></a-asset-item>
      <a-asset-item id="books" src="./assets/models/books/scene.gltf"></a-asset-item>
      <a-asset-item id="window" src="./assets/models/window/scene.gltf"></a-asset-item>
      <a-asset-item id="plant" src="./assets/models/plant/scene.gltf"></a-asset-item>
      <a-asset-item id="carD" src="./assets/models/card/scene.gltf"></a-asset-item>
      <a-asset-item id="controller" src="./assets/models/controller/scene.gltf"></a-asset-item>
      <img id="pizzaboxsprite" src="./assets/images/pizzabox.jpg">
      <img id="cautiontape" src="./assets/images/cautiontape.jpg">
    </a-assets>

    <a-entity pointlight intensity=.4></a-entity>

    <a-plane position="-1.720 1.514 -1.579" rotation="0 45 0" src="./assets/images/instructions.jpg" class="teleporter" collider-check id="middle-tp"></a-plane>
    <!-- Model #1  TELEVISION -->
    <a-entity position="0 0.860 -10" id="tvappend">
      <a-gltf-model scale=".05 .05 .05" src="#television"></a-gltf-model>
      <!-- 0.126 -->
      <a-video position="0 0.901 0.083" scale="3 1.5 1" id="screen"></a-video>
      <a-cylinder position="-.026 .124 .1" scale=".08 .08 .1" rotation="0 90 90" color="#ff0000" id="tvbutton" collider-check active="false" class="tv"></a-cylinder>
    </a-entity>
    <!-- Model #2  LAMP -->
    <a-entity position="-2.800 0 -9.6">
      <a-gltf-model scale=".03 .03 .03" src="#lamp1"></a-gltf-model>
      <a-light type="hemisphere" color="#fff" intensity=.3></a-light>
    </a-entity>
    <a-entity position="2.800 0 -9.6">
      <a-gltf-model scale=".03 .03 .03" src="#lamp1"></a-gltf-model>
      <a-light type="hemisphere" color="#fff" intensity=.3></a-light>
    </a-entity>

    <!-- Model #3  BED -->
    <a-gltf-model position="0 0 8.7" scale=".03  .05 .03" src="#bed" rotation="0 180 0"></a-gltf-model>
    <!-- Model #4  NIGHTSTAND -->
    <a-gltf-model position="1.625 .05 9.676" scale=".3 .3 .3" src="#nightstand" rotation="0 180 0"></a-gltf-model>


    <!-- Model #5  GUITAR -->
    <a-gltf-model position="-1.874 .750 -9.876" scale=".1 .1 .1" rotation="80 0 0" src="#guitar"></a-gltf-model>


    <!-- Model #6  GYM -->
    <a-gltf-model position="-8.389 .103 -1.236" scale=".05 .035 .05" src="#gym"></a-gltf-model>

    <!-- Model #7  BOOKSHELF -->
    <a-gltf-model position="4.198 .850 -9.631" scale=".05 .05 .05" src="#books"></a-gltf-model>

    <!-- Model #8  WINDOW -->
    <a-gltf-model position="-4.196 1.473 7.956" scale=".01 .01 .01" rotation="0 90 0" src="#window"></a-gltf-model>

    <!-- Model #9  PLANT -->
    <a-gltf-model position="9.413 -0.030 -9.302" scale="1 1 1" src="#plant"></a-gltf-model>

    <!-- Model #10  CAR -->
    <a-gltf-model position="1 .075 -2.569" scale=".1 .1 .1" rotation="0 90 0" src="#carD" id="car"></a-gltf-model>

    <!-- Model #11  CONTROLLER -->
    <a-gltf-model position="-.880 .133 -2.488" scale=".001 .001 .001" rotation="-90 0 0" src="#controller" class="controller" id="controller" collider-check active="false"></a-gltf-model>


    <!-- (TELEPORT PADS) -->
    <a-plane position="-9.962 1.699 1.832" rotation="0 90 0" class="teleporter" id="right-tp" collider-check src="./assets/images/poster1.jpg"></a-plane>
    <a-plane position="9.962 1.699 1.832" rotation="0 -90 0" class="teleporter" id="left-tp" collider-check src="./assets/images/poster2.jpg"></a-plane>
    <a-plane position="-4.005 1.699 -9.931" class="teleporter" id="top-tp" collider-check src="./assets/images/poster3.jpg"></a-plane>
    <a-plane position="3.750 1.5 9.969" rotation="0 180 0" class="teleporter" id="back-tp" collider-check src="./assets/images/poster4.jpg"></a-plane>


    <!-- PLAYER -->
    <a-entity  id="player">
      <a-entity camera look-controls position="0 1.6 0">
        <a-cursor
          id="cursor"
          color="white"
          animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
          animation__fusing="property: fusing; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
          event-set__mouseenter="_event: mouseenter; color: springgreen"
          event-set__mouseleave="_event: mouseleave; color: white"
          raycaster="objects: .teleporter, .lighting, .controller, .tv;"></a-cursor>
      </a-entity>
    </a-entity>

    <!-- WALLS -->
    <a-entity id="walls"></a-entity>
    <a-grid id="ground" material="src: #texture-floor" scale=".3 .3 .3"></a-grid>
    <a-grid id="ground" position="0 3 0" static-body material="src: #texture-floor" rotation="90 0 0" scale=".3 .3 .3"></a-grid>



    <!-- Self Created Model #1  TABLE-->
    <a-entity position="8 0 0">
      <a-box scale=".2 1 .2" position="1 .61 -1" color="#0d0d0d"></a-box>
      <a-box scale=".2 1 .2" position="1 .61 1" color="#0d0d0d"></a-box>
      <a-box scale=".2 1 .2" position="-1 .61 -1" color="#0d0d0d"></a-box>
      <a-box scale=".2 1 .2" position="-1 .61 1" color="#0d0d0d"></a-box>
      <a-box scale="2.2 .1 2.2" position="0 1.12 0" color="#2b1912"></a-box>
    </a-entity>
    <!-- Self Created Model #1  END-->

    <!-- Self Created Model #2  CHAIR-->
    <a-entity position="8 0 -2">
      <a-box scale=".2 .5 .2" position=".5 .3 -.5" color="#563325"></a-box>
      <a-box scale=".2 .5 .2" position=".5 .3 .5" color="#563325"></a-box>
      <a-box scale=".2 .5 .2" position="-.5 .3 -.5" color="#563325"></a-box>
      <a-box scale=".2 .5 .2" position="-.5 .3 .5" color="#563325"></a-box>
      <a-box scale="1.2 0.1 1.2" position="0 0.59 0" color="#563325"></a-box>
      <a-box scale="1.2 0.1 1.2" position="0 1.2 -0.55" rotation="90 0 0" color="#563325"></a-box>
    </a-entity>
    <!-- Self Created Model #2  END-->

    <!-- Self Created Model #3  SOFA-->
    <a-entity position="0 0 -6">
      <a-box scale=".2 .5 1" position="-2.4 .84 -.102" color="#787878"></a-box>
      <a-box scale=".2 .5 1" position="2.4 .84 -0.102" color="#787878"></a-box>
      <a-box scale="5 .5 1.2" position="0 .35 .0" color="#787878"></a-box>
      <a-box scale="5 .3 .5" position="0 .84 .45" rotation="90 0 0" color="#262626"></a-box>
    </a-entity>
    <!-- Self Created Model #3  END-->

    <!-- Self Created Model #4  LAMP-->
    <a-entity position="8.8 1.06 .4" rotation="0 45 0" collider-check id="desek-lamp" active="false">
      <a-sphere scale=".14 .14 .14" position="-.17 .581 .002" color="#515336"></a-sphere>
      <a-sphere scale=".15 .15 .15" position="-0.19 .581 .002" id="desk-lamp-light"></a-sphere>
      <a-box scale=".05 .03 .05" position="-.051 .161 -.009" id="desk-lamp-light" color="#000"></a-box>
      <a-cylinder scale=".1 .05 .1" position="0 .14 0" id="desk-lamp-base" class="lighting"></a-cylinder>
      <a-cylinder scale=".01 .05 .01" position="-.02 .58 0" rotation="90 90" color="#515336"></a-cylinder>
      <a-cylinder scale=".01 .5 .01" position="0 0.4 0" color="#515336"></a-cylinder>
      <a-light type="hemisphere" color="#fffa61" position="-0.19 .581 .002" id="desk-lamp-light-real" intensity=0></a-light>
    </a-entity>
    <!-- Self Created Model #4  END-->

    <!-- Self Created Model #5  DOOR-->
    <a-entity position="-10 1.2 -7.5">
      <a-box scale="3 .1 2" position="0" rotation="0 0 90" color="#352303"></a-box>
      <a-sphere scale=".1 .1 .1" position="0 .127 .770" color="#000"></a-sphere>
    </a-entity>
    <!-- Self Created Model #5  END-->

    <!-- Self Created Model #6  COLOR BOARD-->
    <a-entity position="10 1.713 1.109" rotation="0 0 90">
      <a-box scale=".5 .05 .3" position="0" color="#6e6e6e"></a-box>
      <a-box scale=".1 .1 .1" position=".175 .026 0" color="#ff0000" collider-check id="light-color-red" class="lighting"></a-box>
      <a-box scale=".1 .1 .1" position=".026 .026 0" color="#11ff00" collider-check id="light-color-green" class="lighting"></a-box>
      <a-box scale=".1 .1 .1" position="-.130 .026 0" color="#0008ff" collider-check id="light-color-blue" class="lighting"></a-box>
    </a-entity>
    <!-- Self Created Model #6  END-->

    <!-- Self Created Model #6  COVID MODE-->
    <a-entity position="10 1.713 2.592" rotation="0 0 90">
      <a-plane position=".177 .006 .007" rotation="-90 -90 0" scale=".3 .1 1" src="./assets/images/covid.jpg"></a-plane>
      <a-box scale=".2 .05 .2" position="" color="#6e6e6e"></a-box>
      <a-box scale=".1 .1 .1" position="0 0 0" color="#ff0000" collider-check id="covid-mode" class="lighting" active="false"></a-box>
    </a-entity>
    <!-- Self Created Model #6  END-->
    <a-entity visible="false" id="covid-mode-scene">
      <a-entity position="0 .06 -4.6" rotation="90 0 180">
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 0"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.095" rotation="00 0 45"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.201"></a-box>
      </a-entity>

      <a-entity position=".033 .06 -9.376" rotation="90 0 180">
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 0"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.095" rotation="00 0 45"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.201"></a-box>
      </a-entity>

      <a-entity position="7.664 1.229 0.234" rotation="90 0 180">
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 0"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.095" rotation="00 0 45"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.201"></a-box>
      </a-entity>

      <a-entity position="-9.121 .06 3.568" rotation="90 0 45">
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 0"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.095" rotation="00 0 45"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.201"></a-box>
      </a-entity>

      <a-entity position="3.110 .06 9.234" rotation="90 0 0">
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 0"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.095" rotation="00 0 45"></a-box>
        <a-box src="#pizzaboxsprite" scale="1 1 .1" position="0 0 -.201"></a-box>
      </a-entity>
      <a-entity position="-9.927 1.561 -7.540">
        <a-box src="#cautiontape" rotation="45 0 90" scale="3 .3 .2"></a-box>
        <a-box src="#cautiontape" rotation="-45 0 90" scale="3 .3 .2"></a-box>
      </a-entity>
    </a-entity>

  </a-scene>


  <script type="text/javascript">
    let lightActiveStatus = false;
    let sceenLoaded = false;
    let intersectedIn = false;
    AFRAME.registerComponent('pointlight', {
      init: function() {
        this.el.setObject3D('light', new THREE.PointLight());
      }
    });
    AFRAME.registerComponent('collider-check', {
      init: async function() {
        this.el.addEventListener("raycaster-intersected", evt => {
          this.intersectingRaycaster = evt.detail.el.components.raycaster;
          setTimeout(() => {
            if (this.intersectingRaycaster != null && sceenLoaded && !intersectedIn) {
              switch (evt.srcElement.id) {
                case "top-tp":
                  movePlayer('0 0 -8')
                  intersectedIn = true;
                  break;
                case "left-tp":
                  movePlayer('8 0 2')
                  intersectedIn = true;
                  break;
                case "right-tp":
                  movePlayer('-8 0 0')
                  intersectedIn = true;
                  break;
                case "back-tp":
                  movePlayer('2 0 8')
                  intersectedIn = true;
                  break;
                case "middle-tp":
                  movePlayer('0 0 0')
                  intersectedIn = true;
                  break;
                case "desk-lamp-base":
                  evt.srcElement.active = !evt.srcElement.active;
                  let light = document.querySelector('#desk-lamp-light')
                  let lightR = document.querySelector('#desk-lamp-light-real')
                  if (evt.srcElement.active) {
                    lightActiveStatus = evt.srcElement.active;
                    light.setAttribute('color', '#fffa61');
                    lightR.setAttribute('intensity', .5);
                    lightR.setAttribute('color', '#fffa61');
                  } else {
                    lightActiveStatus = evt.srcElement.active;
                    light.setAttribute('color', '#fff');
                    lightR.setAttribute('intensity', 0);
                  }
                  intersectedIn = true;
                  break;
                case "controller":
                  let car = document.querySelector('#car')
                  if (!evt.srcElement.active) {
                    evt.srcElement.active = true;
                    car.setAttribute('animation', 'property:position; to: 4 .075 -2.569; dur: 2000; easing: linear;')
                  }
                  setTimeout(function() {
                    car.setAttribute('animation', 'property:rotation; to: 0 270 0; dur: 2000; easing: linear;')
                    setTimeout(function() {
                      car.setAttribute('animation', 'property:position; to: 1 .075 -2.569; dur: 2000; easing: linear;')
                      setTimeout(function() {
                        car.setAttribute('animation', 'property:rotation; to: 0 90 0; dur: 2000; easing: linear;')
                        evt.srcElement.active = false;
                      }, 2000)
                    }, 2000)
                  }, 2000)
                  intersectedIn = true;
                  break;
                case "light-color-red":
                  if (lightActiveStatus) {
                    let light = document.querySelector('#desk-lamp-light')
                    let lightR = document.querySelector('#desk-lamp-light-real')
                    light.setAttribute('color', '#ff0000')
                    lightR.setAttribute('color', '#ff0000')
                  }
                  intersectedIn = true;
                  break;
                case "light-color-green":
                  if (lightActiveStatus) {
                    let light = document.querySelector('#desk-lamp-light')
                    let lightR = document.querySelector('#desk-lamp-light-real')
                    light.setAttribute('color', '#11ff00')
                    lightR.setAttribute('color', '#11ff00')
                  }
                  intersectedIn = true;
                  break;
                case "light-color-blue":
                  if (lightActiveStatus) {
                    let light = document.querySelector('#desk-lamp-light')
                    let lightR = document.querySelector('#desk-lamp-light-real')
                    light.setAttribute('color', '#0008ff')
                    lightR.setAttribute('color', '#0008ff')
                  }
                  intersectedIn = true;
                  break;
                case "covid-mode":
                  let covidmode = document.querySelector('#covid-mode-scene');
                  let covidmodeButton = document.querySelector('#covid-mode');
                  evt.srcElement.active = !evt.srcElement.active;
                  if(evt.srcElement.active) {
                    covidmode.setAttribute('visible', true);
                    covidmodeButton.setAttribute('color','#11ff00')
                  } else {
                    covidmode.setAttribute('visible', false);
                    covidmodeButton.setAttribute('color','#ff0000')
                  }
                  intersectedIn = true;
                  break;
                case "tvbutton":
                  let screen = document.querySelector("#screen");
                  let screenButton = document.querySelector("#tvbutton");
                  evt.srcElement.active = !evt.srcElement.active;
                  if(evt.srcElement.active) {
                    screen.setAttribute('position','0 0.901 0.126')
                    screen.setAttribute('src','./assets/videos/video1.mp4');
                    screenButton.setAttribute('color', '#11ff00');
                  } else {
                    //screen.setAttribute('position','0 0.901 0.083')
                    screen.setAttribute('src','./assets/videos/video2.mp4');
                    screenButton.setAttribute('color', '#ff0000')
                  }

                  intersectedIn = true;
                  break;
                default:
              }
            }
          }, 1500)
        });
        this.el.addEventListener("raycaster-intersected-cleared", () => {
          this.intersectingRaycaster = null;
          intersectedIn = false;
        });
      }
    });
    var map = {
      "data": [
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 1, 1, 0, 0, 0, 0, 1, 1, 1,
        1, 1, 1, 0, 0, 0, 0, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1

      ],
      "height": 10,
      "width": 10
    }
    document.querySelector('a-scene').addEventListener('loaded', function() {
      sceenLoaded = true;
      var WALL_SIZE = 2.5,
        WALL_HEIGHT = 3;
      var el = document.querySelector('#walls');
      var player = document.querySelector('#player');
      var wall;

      for (var x = 0; x < map.height; x++) {
        for (var y = 0; y < map.width; y++) {

          var i = y * map.width + x;
          var position = (((x - map.width / 2) * WALL_SIZE) + map.width / 8) + ' ' + 1.5 + ' ' + (((y - map.height / 2) * WALL_SIZE) + map.height / 8);
          if (map.data[i] === 1) {
            // Create wall
            wall = document.createElement('a-box');
            el.appendChild(wall);
            wall.setAttribute('color', '#fff');
            wall.setAttribute('material', 'src: #texture-wall;');
            wall.setAttribute('width', WALL_SIZE);
            wall.setAttribute('height', WALL_HEIGHT);
            wall.setAttribute('depth', WALL_SIZE);
            wall.setAttribute('position', position);
            wall.setAttribute('static-body', '');
          }
        }
      }

    });

    function movePlayer(position) {
      player.setAttribute("position", position);
    }
  </script>
</body>

</html>
