<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Hello, World! - A-Frame</title>
  <meta name="description" content="Hello, World! - A-Frame">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r120/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.0.4/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-animation-component@5.1.2/dist/aframe-animation-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
</head>

<body>
  <a-scene device-orientation-permission-ui="">
    <a-assets>
      <img id="texture-floor" src="./assets/images/floor.jpg">
      <img id="texture-wall" src="./assets/images/wall.jpg">
      <a-asset-item id="hazard" src="./assets/models/hazard_suit/scene.gltf"></a-asset-item>
      <a-asset-item id="hazmat" src="./assets/models/hazmat_suit/scene.gltf"></a-asset-item>
      <a-asset-item id="television" src="./assets/models/television/scene.gltf"></a-asset-item>
      <a-asset-item id="carpet" src="./assets/models/carpet/scene.gltf"></a-asset-item>
      <a-asset-item id="lamp1" src="./assets/models/lamp/scene.gltf"></a-asset-item>
      <a-asset-item id="lamp2" src="./assets/models/lamp/scene.gltf"></a-asset-item>
      <a-asset-item id="stove" src="./assets/models/stove/scene.gltf"></a-asset-item>
      <a-asset-item id="klamp" src="./assets/models/kitchenLamp/scene.gltf"></a-asset-item>
    </a-assets>
    <a-gltf-model position="0 0.860 -10" scale=".05 .05 .05"src="#television" ></a-gltf-model>
    <a-gltf-model position="-2.800 .1 -9.6" scale=".03 .03 .03"src="#lamp1" ></a-gltf-model>
    <a-gltf-model position="2.800 .1 -9.6" scale=".03 .03 .03"src="#lamp2" ></a-gltf-model>
    <a-gltf-model position="0 .6 9.66" scale=".03 .03 .03"src="#stove" rotation="0 90 0" ></a-gltf-model>
    <a-gltf-model position="0 2 9.3" scale=".01 .01 .01"src="#klamp" rotation="0 0 0" ></a-gltf-model>
    <!-- <a-light position="1 1 -10" radius="0.5" height="1.5" color="#FFC65D"></a-light> -->

    <a-sky color="#255555"></a-sky>
    <a-entity camera look-controls="" universal-controls position="0 1.6 0" id="player">
      <a-entity cursor="fuse: true; fuseTimeout: 500" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.02" material="color: white; shader: flat">
        <a-animation begin="click" easing="ease-in" attribute="scale" dur="150" fill="forwards" from="0.1 0.1 0.1" to="1 1 1"></a-animation>
        <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" dur="1500" fill="backwards" from="1 1 1" to="0.1 0.1 0.1"></a-animation>
      </a-entity>
    </a-entity>
    <a-entity id="walls" dynamic-body></a-entity>
    <a-grid id="ground" static-body material="src: #texture-floor"></a-grid>
    <a-grid id="ground" position="0 3 0" static-body material="src: #texture-floor" rotation="90 0 0"></a-grid>

    <!-- TELEPORT PADS-->
    <a-gltf-model position="0 .1 -8" scale="3 1 3"  src="#carpet" onclick="movePlayer('0 1.6 -8')"></a-gltf-model>
    <a-gltf-model position="8 .1 0" scale="3 1 3" rotation="0 90 0" src="#carpet" onclick="movePlayer('8 1.6 0')"></a-gltf-model>
    <a-gltf-model position="-8 .1 0" scale="3 1 3" rotation="0 90 0" src="#carpet" onclick="movePlayer('-8 1.6 0')"></a-gltf-model>
    <a-gltf-model position="0 .1 8" scale="3 1 3" src="#carpet" onclick="movePlayer('0 1.6 8')"></a-gltf-model>
    <a-gltf-model position="0 .1 0" scale="3 1 3" src="#carpet" onclick="movePlayer('0 1.6 0')"></a-gltf-model>
  </a-scene>


  <script type="text/javascript">
    AFRAME.registerComponent('pointlight', {
      init: function() {
        this.el.setObject3D('light', new THREE.PointLight());
      }
    });
    var map = {
      "data": [
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1

      ],
      "height": 10,
      "width": 10
    }
    document.querySelector('a-scene').addEventListener('loaded', function() {
      var WALL_SIZE = 2.5,
        WALL_HEIGHT = 3;
      var el = document.querySelector('#walls');
      var player = document.querySelector('#player');
      var wall;

      for (var x = 0; x < map.height; x++) {
        for (var y = 0; y < map.width; y++) {

          var i = y * map.width + x;
          var position = (((x - map.width / 2) * WALL_SIZE) + map.width/8) + ' ' + 1.5 + ' ' + (((y - map.height / 2) * WALL_SIZE) + map.height/8);
          if (map.data[i] === 1) {
            // Create wall
            wall = document.createElement('a-box');
            el.appendChild(wall);
            wall.setAttribute('color', '#fff');
            wall.setAttribute('material', 'src: #texture-wall;');
            wall.setAttribute('width', WALL_SIZE);
            wall.setAttribute('height', WALL_HEIGHT);
            wall.setAttribute('depth', WALL_SIZE);
            wall.setAttribute('position', position);
            wall.setAttribute('static-body', '');
          }

          // if (map.data[i] === 2) {
          //   // Set player position
          //   document.querySelector('#player').setAttribute('position', position);
          // }

        }
      }
      console.info('Walls added.');
    });

    function movePlayer(position) {
      player.setAttribute("position", position);
    }
  </script>
</body>

</html>
