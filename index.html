<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Hello, World! - A-Frame</title>
  <meta name="description" content="Hello, World! - A-Frame">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.0.4/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
</head>

<body>
  <a-scene device-orientation-permission-ui="">
    <a-assets>
      <img id="texture-floor" src="./assets/images/floor.jpg">
      <img id="texture-wall" src="./assets/images/wall.jpg">
      <a-asset-item id="television" src="./assets/models/television/scene.gltf"></a-asset-item>
      <a-asset-item id="carpet" src="./assets/models/carpet/scene.gltf"></a-asset-item>
      <a-asset-item id="lamp1" src="./assets/models/lamp/scene.gltf"></a-asset-item>
      <a-asset-item id="bed" src="./assets/models/bed/scene.gltf"></a-asset-item>
      <a-asset-item id="nightstand" src="./assets/models/night_stand/scene.gltf"></a-asset-item>
      <a-asset-item id="guitar" src="./assets/models/guitar/scene.gltf"></a-asset-item>
      <a-asset-item id="gym" src="./assets/models/gym/scene.gltf"></a-asset-item>
      <a-asset-item id="books" src="./assets/models/books/scene.gltf"></a-asset-item>
      <a-asset-item id="window" src="./assets/models/window/scene.gltf"></a-asset-item>
      <a-asset-item id="plant" src="./assets/models/plant/scene.gltf"></a-asset-item>

      <a-asset-item id="fan" src="./assets/models/fan/scene.gltf"></a-asset-item>
    </a-assets>

    <!-- Model #1  TELEVISION -->
    <a-gltf-model position="0 0.860 -10" scale=".05 .05 .05" src="#television"></a-gltf-model>
    <!-- Model #2  LAMP -->
    <a-gltf-model position="-2.800 .1 -9.6" scale=".03 .03 .03" src="#lamp1"></a-gltf-model>
    <a-gltf-model position="2.800 .1 -9.6" scale=".03 .03 .03" src="#lamp1"></a-gltf-model>
    <!-- Model #3  BED -->
    <a-gltf-model position="0 0 8.7" scale=".03  .05 .03" src="#bed" rotation="0 180 0"></a-gltf-model>
    <!-- Model #4  NIGHTSTAND -->
    <a-gltf-model position="1.625 .150 9.676" scale=".3 .3 .3" src="#nightstand" rotation="0 180 0"></a-gltf-model>

    <!-- Model #5  CARPET (TELEPORT PADS) -->
    <!-- <a-gltf-model position="0 .1 -8" scale="3 1 3" src="#carpet" onclick="movePlayer('0 0 -8')" class="teleporter" id="top-tp" collider-check></a-gltf-model>
    <a-gltf-model position="8 .1 0" scale="3 1 3" rotation="0 90 0" src="#carpet" onclick="movePlayer('8 0 0')" id="left-tp" class="teleporter" collider-check></a-gltf-model>
    <a-gltf-model position="-8 .1 0" scale="3 1 3" rotation="0 90 0" src="#carpet" onclick="movePlayer('-8 0 0')" id="right-tp" class="teleporter" collider-check></a-gltf-model>
    <a-gltf-model position="0 .1 8" scale="3 1 3" src="#carpet" onclick="movePlayer('0 0 8')" class="teleporter" id="back-tp" collider-check></a-gltf-model>
    <a-gltf-model position="0 .1 0" scale="3 1 3" src="#carpet" onclick="movePlayer('0 0 0')" class="teleporter" id="middle-tp" collider-check></a-gltf-model> -->
    <a-plane position="-9.962 1.699 1.832" rotation="0 90 0" color="black" class="teleporter" id="right-tp" collider-check></a-plane>
    <a-plane position="9.962 1.699 1.832" rotation="0 -90 0" color="black" class="teleporter" id="left-tp" collider-check></a-plane>
    <a-plane position="-4.005 1.699 -9.931"  color="black" class="teleporter" id="top-tp" collider-check></a-plane>
    <a-plane position="3.750 1.5 9.969" rotation="0 180 0" color="black" class="teleporter" id="back-tp" onclick="movePlayer('0 0 8')" collider-check></a-plane>
    <!-- Model #6  GUITAR -->
    <a-gltf-model position="-1.874 .850 -9.876" scale=".1 .1 .1" rotation="80 0 0" src="#guitar"></a-gltf-model>


    <!-- Model #7  GYM -->
    <a-gltf-model position="-8.389 .103 -1.236" scale=".05 .035 .05" src="#gym"></a-gltf-model>

    <!-- Model #8  BOOKSHELF -->
    <a-gltf-model position="4.198 .850 -9.631" scale=".05 .05 .05" src="#books"></a-gltf-model>

    <!-- Model #9  WINDOW -->
    <a-gltf-model position="-9.219 1.473 5.637" scale=".01 .01 .01" rotation="0 90 0" src="#window"></a-gltf-model>

    <!-- Model #10  PLANT -->
    <a-gltf-model position="9.413 -0.030 -9.302" scale="1 1 1" src="#plant"></a-gltf-model>

    <!-- PLAYER -->
    <a-entity universal-controls id="player">
      <a-entity camera position="0 1.6 0" look-controls>
        <a-entity  position="0 0 -1" geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.02" material="color: white; shader: flat">
        </a-entity>
        <a-entity raycaster="objects: .teleporter, .lighting;" line="color:orange; opacity:1"></a-entity>
      </a-entity>
    </a-entity>

    <!-- WALLS -->
    <a-entity id="walls" dynamic-body></a-entity>
    <a-grid id="ground" static-body material="src: #texture-floor" scale=".3 .3 .3"></a-grid>
    <a-grid id="ground" position="0 3 0" static-body material="src: #texture-floor" rotation="90 0 0" scale=".3 .3 .3"></a-grid>

    <a-entity pointlight></a-entity>

    <!-- Self Created Model #1  TABLE-->
    <a-entity position="8 0 0">
      <a-box scale=".2 1 .2" position="1 .61 -1" color="#0d0d0d"></a-box>
      <a-box scale=".2 1 .2" position="1 .61 1" color="#0d0d0d"></a-box>
      <a-box scale=".2 1 .2" position="-1 .61 -1" color="#0d0d0d"></a-box>
      <a-box scale=".2 1 .2" position="-1 .61 1" color="#0d0d0d"></a-box>
      <a-box scale="2.2 .1 2.2" position="0 1.12 0" color="#2b1912"></a-box>
    </a-entity>
    <!-- Self Created Model #1  END-->

    <!-- Self Created Model #2  CHAIR-->
    <a-entity position="8 0 -2">
      <a-box scale=".2 .5 .2" position=".5 .3 -.5" color="#563325"></a-box>
      <a-box scale=".2 .5 .2" position=".5 .3 .5" color="#563325"></a-box>
      <a-box scale=".2 .5 .2" position="-.5 .3 -.5" color="#563325"></a-box>
      <a-box scale=".2 .5 .2" position="-.5 .3 .5" color="#563325"></a-box>
      <a-box scale="1.2 0.1 1.2" position="0 0.59 0" color="#563325"></a-box>
      <a-box scale="1.2 0.1 1.2" position="0 1.2 -0.55" rotation="90 0 0" color="#563325"></a-box>
    </a-entity>
    <!-- Self Created Model #2  END-->

    <!-- Self Created Model #3  SOFA-->
    <a-entity position="0 0 -6">
      <a-box scale=".2 .5 1" position="-2.4 .84 -.102" color="#787878"></a-box>
      <a-box scale=".2 .5 1" position="2.4 .84 -0.102" color="#787878"></a-box>
      <a-box scale="5 .5 1.2" position="0 .35 .0" color="#787878"></a-box>
      <a-box scale="5 .3 .5" position="0 .84 .45" rotation="90 0 0" color="#262626"></a-box>
    </a-entity>
    <!-- Self Created Model #3  END-->

    <!-- Self Created Model #4  LAMP-->
    <a-entity position="8.8 1.06 .4" rotation="0 45 0" collider-check id="desek-lamp" active="false">
      <a-sphere scale=".14 .14 .14" position="-.17 .581 .002" color="#515336"></a-sphere>
      <a-sphere scale=".15 .15 .15" position="-0.19 .581 .002" id="desk-lamp-light"></a-sphere>
      <a-box scale=".05 .03 .05" position="-.051 .161 -.009" id="desk-lamp-light" color="#000"></a-box>
      <a-cylinder scale=".1 .05 .1" position="0 .14 0" id="desk-lamp-base" class="lighting"></a-cylinder>
      <a-cylinder scale=".01 .05 .01" position="-.02 .58 0" rotation="90 90" color="#515336"></a-cylinder>
      <a-cylinder scale=".01 .5 .01" position="0 0.4 0" color="#515336"></a-cylinder>
      <!-- <a-light type="hemisphere" color="#fffa61" position="-0.19 .581 .002" id="desk-lamp-light-real" intensity=0></a-light> -->
    </a-entity>
    <!-- Self Created Model #4  END-->

    <!-- Self Created Model #5  DOOR-->
    <!-- <a-entity position="8 0 -2">
      <a-box scale=".2 .5 .2" position=".5 .3 -.5"></a-box>
      <a-box scale=".2 .5 .2" position=".5 .3 .5"></a-box>
      <a-box scale=".2 .5 .2" position="-.5 .3 -.5"></a-box>
      <a-box scale=".2 .5 .2" position="-.5 .3 .5"></a-box>
      <a-box scale="1.2 0.1 1.2" position="0 0.59 0"></a-box>
      <a-box scale="1.2 0.1 1.2" position="0 1.2 -0.55" rotation="90 0 0"></a-box>
    </a-entity> -->
    <!-- Self Created Model #5  END-->
  </a-scene>


  <script type="text/javascript">
    AFRAME.registerComponent('pointlight', {
      init: function() {
        this.el.setObject3D('light', new THREE.PointLight());
      }
    });
    AFRAME.registerComponent('collider-check', {
      init: async function() {
        this.el.addEventListener("raycaster-intersected", evt => {
          console.log('in')
          this.intersectingRaycaster = evt.detail.el.components.raycaster;
          setTimeout(() => {
            if (this.intersectingRaycaster != null) {
              switch (evt.srcElement.id) {
                case "top-tp":
                  movePlayer('0 0 -8')
                  break;
                case "left-tp":
                  movePlayer('8 0 2')
                  break;
                case "right-tp":
                  movePlayer('-8 0 0')
                  break;
                case "back-tp":
                  movePlayer('2 0 8')
                  break;
                case "middle-tp":
                  movePlayer('0 0 0')
                  break;
                  // case "desk-lamp-base":
                  //   evt.srcElement.active = !evt.srcElement.active;
                  //   let light = document.querySelector('#desk-lamp-light')
                  //   let lightR = document.querySelector('#desk-lamp-light-real')
                  //   if(evt.srcElement.active) {
                  //     light.setAttribute('color','#fffa61');
                  //     lightR.setAttribute('intensity',.5);
                  //   } else {
                  //     light.setAttribute('color','#fff');
                  //     lightR.setAttribute('intensity',0);
                  //   }
                  //   break;
                default:
              }
            }
          }, 1500)
        });
        this.el.addEventListener("raycaster-intersected-cleared", () => {
          this.intersectingRaycaster = null;
        });
      }
    });
    var map = {
      "data": [
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1

      ],
      "height": 10,
      "width": 10
    }
    document.querySelector('a-scene').addEventListener('loaded', function() {
      var WALL_SIZE = 2.5,
        WALL_HEIGHT = 3;
      var el = document.querySelector('#walls');
      var player = document.querySelector('#player');
      var wall;

      for (var x = 0; x < map.height; x++) {
        for (var y = 0; y < map.width; y++) {

          var i = y * map.width + x;
          var position = (((x - map.width / 2) * WALL_SIZE) + map.width / 8) + ' ' + 1.5 + ' ' + (((y - map.height / 2) * WALL_SIZE) + map.height / 8);
          if (map.data[i] === 1) {
            // Create wall
            wall = document.createElement('a-box');
            el.appendChild(wall);
            wall.setAttribute('color', '#fff');
            wall.setAttribute('material', 'src: #texture-wall;');
            wall.setAttribute('width', WALL_SIZE);
            wall.setAttribute('height', WALL_HEIGHT);
            wall.setAttribute('depth', WALL_SIZE);
            wall.setAttribute('position', position);
            wall.setAttribute('static-body', '');
          }


        }
      }

    });

    function movePlayer(position) {
      player.setAttribute("position", position);
    }
  </script>
</body>

</html>
